# SA_RAG Agent

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø–æ–∏—Å–∫–∞ –∫–æ–º–ø–∞–Ω–∏–∏ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π RAG (Retrieval-Augmented Generation) –∏ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞** —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –ø—Ä–æ—Ñ–∏–ª—è–º–∏
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π** —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- **–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** (2FA) —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∫–æ–¥–æ–≤ –ø–æ email
- **–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª–µ–π** —á–µ—Ä–µ–∑ email —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏
- **AI –∞–≥–µ–Ω—Ç** —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π RAG –¥–ª—è –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∏ –æ—Ç–≤–µ—Ç–æ–≤
- **MCP RAG —Å–µ—Ä–≤–µ—Ä** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π —á–µ—Ä–µ–∑ MCP –ø—Ä–æ—Ç–æ–∫–æ–ª
- **RESTful API** —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π (Swagger)
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ –º–æ–¥—É–ª—è–º
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
SA_RAG/
‚îú‚îÄ‚îÄ app/                          # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ api/                      # API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ endpoints/            # –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py          # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ two_factor_auth.py # 2FA –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ai_agent.py      # AI –∞–≥–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å RAG
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routers.py            # –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils.py              # –£—Ç–∏–ª–∏—Ç—ã API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validators.py         # –í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ core/                     # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db.py                 # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ init_db.py            # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.py               # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ crud/                     # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ models/                   # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ schemas/                  # Pydantic —Å—Ö–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ services/                 # –°–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ agent/               # AI –∞–≥–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai_agent.py      # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∞–≥–µ–Ω—Ç–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mcp_client.py    # MCP –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ system_prompt.txt # –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mcp_rag/             # MCP RAG —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ server.py         # –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ quick_test.py     # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ logging/                  # –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ main.py                   # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ tests/                        # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ alembic/                      # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îú‚îÄ‚îÄ requirements.txt              # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README.md                     # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
git clone <repository-url>
cd SA_RAG
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=your_user
POSTGRES_PASSWORD=your_password
POSTGRES_DB=sa_rag_db

# Email –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
YANDAX_EMAIL=your_email@yandex.ru
YANDEX_APP_PASS=your_app_password

# RAG API –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
KEY_ID=your_key_id
KEY_SECRET=your_key_secret
AUTH_URL=https://your-auth-url
RETRIEVE_URL_TEMPLATE=https://your-retrieve-url
KNOWLEDGE_BASE_ID=your_kb_id
KNOWLEDGE_BASE_VERSION_ID=your_version_id
EVOLUTION_PROJECT_ID=your_project_id
RETRIEVE_LIMIT=6

# JWT –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
SECRET=your_secret_key
JWT_TOKEN_LIFETIME=3600

# –ü–µ—Ä–≤—ã–π —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
FIRST_SUPERUSER_EMAIL=admin@example.com
FIRST_SUPERUSER_PASSWORD=admin_password

# AI –∞–≥–µ–Ω—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
MCP_SERVER_URL=http://localhost:8003
MCP_TRANSPORT=sse
MCP_RAG_TOOL_NAME=request_to_rag
GIGACHAT_MODEL=GigaChat:latest
GIGACHAT_TEMPERATURE=0.1
GIGACHAT_SCOPE=GIGACHAT_API_PERS
GIGACHAT_CREDENTIALS=your_gigachat_credentials
GIGACHAT_VERIFY_SSL=true
```

### 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
alembic upgrade head

# –ò–ª–∏ —á–µ—Ä–µ–∑ Makefile
make init-db
```

## üöÄ –ó–∞–ø—É—Å–∫

### –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ FastAPI —Å–µ—Ä–≤–µ—Ä–∞
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

### MCP RAG —Å–µ—Ä–≤–µ—Ä

```bash
# –ó–∞–ø—É—Å–∫ MCP RAG —Å–µ—Ä–≤–µ—Ä–∞
python -m app.services.mcp_rag.server
```

### AI –∞–≥–µ–Ω—Ç

AI –∞–≥–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ MCP RAG —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ FastAPI endpoint `/ask_with_ai`. 
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ MCP RAG —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º AI –∞–≥–µ–Ω—Ç–∞.

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤

```bash
# –ß–µ—Ä–µ–∑ pytest
pytest

# –ß–µ—Ä–µ–∑ Makefile
make test

# –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç
python run_tests.py
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ MCP RAG —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç
python app/services/mcp_rag/quick_test.py "–≤–∞—à –∑–∞–ø—Ä–æ—Å"

# –ü—Ä–∏–º–µ—Ä
python app/services/mcp_rag/quick_test.py "–ö–∞–∫–∏–µ —É—Å–ª–æ–≤–∏—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –ö–∏–∞?"
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç—ã

- `test_user_endpoints.py` - –¢–µ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- `test_two_factor_auth_temp_tokens.py` - –¢–µ—Å—Ç—ã 2FA
- `test_password_reset.py` - –¢–µ—Å—Ç—ã —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª–µ–π
- `test_user_integration.py` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- `test_user_validation.py` - –¢–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–≤–∫–ª—é—á–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–∞—Ä–æ–ª–µ–π)
- `test_schemas_2fa.py` - –¢–µ—Å—Ç—ã —Å—Ö–µ–º –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

## üìö API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å–∞–º:

- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `POST /users/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (—Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è)
- `POST /users/login` - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- `GET /users/me` - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
- `PUT /users/me` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è

#### –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `POST /2fa/send-code` - –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞ 2FA
- `POST /2fa/verify-code` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ 2FA
- `POST /2fa/disable` - –û—Ç–∫–ª—é—á–µ–Ω–∏–µ 2FA

#### –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª–µ–π
- `POST /users/forgot-password` - –ó–∞–ø—Ä–æ—Å —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
- `POST /users/reset-password` - –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è

#### AI –∞–≥–µ–Ω—Ç
- `POST /ask_with_ai` - –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π

## üîê –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –ø–∞—Ä–æ–ª—è

–ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–∏—Å—Ç–µ–º–∞ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –≤–≤–æ–¥–∞:

```json
{
  "email": "user@example.com",
  "password": "SecurePass123!",
  "password_confirm": "SecurePass123!",
  "first_name": "Alex",
  "last_name": "Fill",
  "date_of_birth": "1992-05-20",
  "phone": "+79031234567"
}
```

### –ü—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

- **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è**: `password` –∏ `password_confirm` –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞**: 8 —Å–∏–º–≤–æ–ª–æ–≤
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞**: 128 —Å–∏–º–≤–æ–ª–æ–≤
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: –º–∏–Ω–∏–º—É–º 1 –±—É–∫–≤–∞, 1 —Ü–∏—Ñ—Ä–∞, 1 —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª
- **–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏**: –ü—Ä–∏ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª–µ–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ "–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç"

### –ü—Ä–∏–º–µ—Ä—ã –æ—à–∏–±–æ–∫

```json
// –ù–µ—Å–æ–≤–ø–∞–¥–∞—é—â–∏–µ –ø–∞—Ä–æ–ª–∏
{
  "password": "Password123!",
  "password_confirm": "DifferentPass123!"
}
// –û—à–∏–±–∫–∞: "–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç"

// –°–ª–∞–±—ã–π –ø–∞—Ä–æ–ª—å
{
  "password": "123",
  "password_confirm": "123"
}
// –û—à–∏–±–∫–∞: "–ü–∞—Ä–æ–ª—å –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"
```

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞

- **FastAPI** - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **SQLAlchemy** - ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- **Alembic** - –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
- **Pydantic** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- **FastMCP** - MCP —Å–µ—Ä–≤–µ—Ä –¥–ª—è RAG
- **Pytest** - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ –º–æ–¥—É–ª—è–º:
- `app/logging/logs/user.log` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `app/logging/logs/two_factor_auth.log` - 2FA –æ–ø–µ—Ä–∞—Ü–∏–∏

### –ú–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
alembic revision --autogenerate -m "–æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
alembic upgrade head

# –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
alembic downgrade -1
```

## üê≥ Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t sa-rag-agent .

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run -p 8000:8000 --env-file .env sa-rag-agent
```

## üìù –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è |
|------------|----------|--------------|
| `POSTGRES_*` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î | ‚úÖ |
| `YANDAX_EMAIL` | Email –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ | ‚úÖ |
| `YANDEX_APP_PASS` | –ü–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | ‚úÖ |
| `KEY_ID` | ID –∫–ª—é—á–∞ RAG API | ‚úÖ |
| `KEY_SECRET` | –°–µ–∫—Ä–µ—Ç RAG API | ‚úÖ |
| `AUTH_URL` | URL –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ RAG | ‚úÖ |
| `RETRIEVE_URL_TEMPLATE` | URL –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ RAG | ‚úÖ |
| `KNOWLEDGE_BASE_ID` | ID –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π | ‚úÖ |
| `EVOLUTION_PROJECT_ID` | ID –ø—Ä–æ–µ–∫—Ç–∞ | ‚úÖ |
| `MCP_SERVER_URL` | URL MCP —Å–µ—Ä–≤–µ—Ä–∞ | ‚úÖ |
| `MCP_TRANSPORT` | –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç MCP (sse) | ‚úÖ |
| `GIGACHAT_CREDENTIALS` | –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ GigaChat | ‚úÖ |

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
3. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã
5. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏.

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ `app/logging/logs/`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

---

**–í–µ—Ä—Å–∏—è**: 1.2.0  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –Ø–Ω–≤–∞—Ä—å 2025

### –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

#### v1.2.0 (–Ø–Ω–≤–∞—Ä—å 2025)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –ü–æ–ª–µ `password_confirm` –≤ —Å—Ö–µ–º–µ `UserCreate`
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞ –ø–∞—Ä–æ–ª–µ–π —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –æ–± –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–æ–≤–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ `password_confirm` –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è)

#### v1.1.0 (–î–µ–∫–∞–±—Ä—å 2024)
- ‚úÖ –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ AI –∞–≥–µ–Ω—Ç —Å RAG –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
- ‚úÖ MCP RAG —Å–µ—Ä–≤–µ—Ä
